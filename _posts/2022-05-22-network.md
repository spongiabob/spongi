---
title: 网络学习记录
author: 
  name: nancyxia
  link: https://github.com/Spongiabob
date: 2022-05-22 18:32:00 +8
categories: [Blogging, Tool]
tags: [网络相关]
---

网络协议、网络问题跟踪



### 一、网络协议

OSI 的七层模型，和 TCP/IP 的四层 / 五层模型
![分层模型]({{"/assets/img/blog/osi.webp"|absolute_url}}){: width="100" height="100"}
![TLS分层]({{"/assets/img/blog/tls.webp"|absolute_url}}){: width="100" height="100"}

### 二、基本定义

1.TCP 流？
(1)TCP 流，就是英文的 TCP Stream。Stream 这个词有“流”的意思，也有“连续的事件”这样一个含义，所以它是有前后、有顺序的，这也正对应了 TCP 的特性。
(2)跟 Stream 相对的一个词是 Datagram，它是指没有前后关系的数据单元，比如 UDP 和 IP 都属于 Datagram。在 Linux 网络编程里面，TCP 对应的 socket 类型是 SOCK_STREAM，而 UDP 对应的，就是 SOCK_DGRAM 了。显然，DGRAM 就是 Datagram 的简写。
(3)在具体的网络报文层面，一个 TCP 流，对应的就是一个五元组：传输协议类型、源 IP、源端口、目的 IP、目的端口。比如，今天你访问了极客时间网站，那么你这次的 TCP 流就可能就是这样一个五元组：
(TCP, your_ip, your_port, geekbang_ip, 443)

2.报文（packet）
是一种相对宽泛和通用的说法，基本上每一层都可以用。比如，在应用层，你可以说“HTTP 报文”；在传输层，你可以说“TCP 报文”；同样的，在网络层，当然就是“IP 报文”了。事实上，网络层也是“报文”一词被使用最多的场景了。数据包也是类似的，可以在很多场景下通用。
3.帧（frame）
是二层也就是数据链路层的概念，代表了二层报文，它包含帧头、载荷、帧尾。注意，帧是有尾部的，而其他像 IP、TCP、HTTP 等层级的报文，都没有尾部。我们不可以说“TCP 帧”或者“IP 帧”，虽然也许对方也明白你的意思，但我们都想做得专业一点，不是嘛。这里还有个小知识点：HTTP/2 实现了多路复用，其中也有帧的概念，不过那个帧，跟这里网络二层的帧，除了名称相同以外，就没有别的联系了。
4.分组
是 IP 层报文，也就是狭义的 packet。
5.段特指 TCP segment
也就是 TCP 报文。既然 segment 是“部分”的意思，那这个“整体”又是什么呢？它就是在应用层交付给传输层的消息（message）。当 message 被交付给传输层时，如果这个 message 的原始尺寸，超出了传输层数据单元的限制（比如超出了 TCP 的 MSS），它就会被划分为多个 segment。这个过程就是分段（segmentation），也是 TCP 层的一个很重要的职责。
![报文分层]({{"/assets/img/blog/fc.webp"|absolute_url}}){: width="100" height="100"}


### 三、构建Django项目
1.选定目录，在终端（mac）敲入以下命令
django-admin startproject myproject(文件名)
目录结构：
![django]({{"/assets/img/blog/osi.webp"|absolute_url}}){: width="100" height="100"}
2.进入项目根目录，创建一个myapp目录
python manage.py startapp myapp
![django]({{"/assets/img/blog/django2.jpeg"|absolute_url}}){: width="100" height="100"}
3.seting.py配置
1）在myproject下的seting.py配置文件中，把默认的sqllite3数据库换成我们mysql数据库
```yaml
# Database
# https://docs.djangoproject.com/en/1.11/ref/settings/#databases

DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.mysql',
        'NAME': 'myproject',
        'USER': 'root',
        'PASSWORD': 'root',
        'HOST': '127.0.0.1',
    }
}
```
{: file="seting.py"}
2）把新建的myapp加如到seting.py中的installed_apps列表里
```yaml
INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
     'myapp',
]
```
{: file="seting.py"}

4.使用modle配置db 数据表
1）在app目录下的models.py中写一个数据库表对应的model
```yaml
# -*- coding: utf-8 -*-
from __future__ import unicode_literals

from django.db import models

# Create your models here.
class Book(models.Model):
    book_name = models.CharField(max_length=64)
    add_time = models.DateTimeField(auto_now_add=True)

    def __unicode__(self):
        return self.book_name
#未指定主键，数据库自动设置一个新增主键
```
2）在项目的根目录，输入命令 
python manage.py makemigrations myapp
python manage.py migrate


5.app 目录views新增相关操作接口
1）show_books返回所有书籍列表
2）add_book新增一本书籍
```yaml
from django.shortcuts import render
# Create your views here.
@require_http_methods(["GET"])
def add_book(request):
    response = {}
    try:
        book = Book(book_name=request.GET.get('book_name'))
        book.save()
        response['msg'] = 'success'
        response['error_num'] = 0
    except  Exception as e:
        response['msg'] = str(e)
        response['error_num'] = 1

    return JsonResponse(response)

@require_http_methods(["GET"])
def show_books(request):
    response = {}
    try:
        books = Book.objects.filter()
        response['list']  = json.loads(serializers.serialize("json", books))
        response['msg'] = 'success'
        response['error_num'] = 0
    except  Exception as e:
        response['msg'] = str(e)
        response['error_num'] = 1

    return JsonResponse(response)
```
6.在app目录下新增一个urls.py文件，新增从后台的接口路由映射
```yaml
from django.contrib import admin
from django.urls import path
import views
from django.conf.urls import url, include

urlpatterns = [
    url(r'add_book$', views.add_book, ),
    url(r'show_books$', views.show_books, ),
    ]
```
7.把app下的urls添加到project下的urls中，完成路由
```yaml
from django.conf.urls import url, include
from django.contrib import admin
from django.views.generic import TemplateView
import myapp.urls

urlpatterns = [
    url(r'^admin/', admin.site.urls),
    url(r'^api/', include(myapp.urls)),
    url(r'^$', TemplateView.as_view(template_name="index.html")),
]
```
















